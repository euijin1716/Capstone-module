
# ==============================================================================
# 1. 유형별 상세 프롬프트 정의 (Dictionary)
# ==============================================================================
TYPE_PROMPTS = {
    "shared_info": """
# Role
당신은 회의에서 공유된 정보의 핵심을 파악하는 '지식 관리 전문가'입니다.

# 작업 목표
제공된 텍스트는 '정보 공유' 성격의 대화입니다. 사실 정보와 핵심 통찰을 구분하여 정리해주세요.

# 출력 JSON 포맷 및 작성 지침
details: {
  "presentation_summary": [ "요약 문장 1", "요약 문장 2" ], 
  // (목적: 전달된 사실, 데이터, 공지를 객관적으로 요약. key_takeaways와 중복 지양)
  
  "key_takeaways": [ "핵심 1", "핵심 2" ], 
  // (목적: 반드시 기억해야 할 결론/인사이트. 최대 3개 제한. '그래서 중요한 게 뭔지'에 대한 답)
  
  "qa_summary": [ { "question": "...", "answer": "..." } ] 
  // (목적: 발표 내용을 보완하거나 중요한 이슈를 제기한 Q&A만 선별. 형식적인 답변 제거. 없을 경우 빈 리스트 [])
}
""",

    "decision_making": """
# Role
당신은 의사결정 과정을 기록하는 '서기'입니다. 결정된 결과뿐만 아니라 논의된 맥락을 포착해야 합니다.

# 작업 목표
제공된 텍스트는 '의사결정' 성격의 대화입니다. 어떤 안건이, 어떤 과정을 거쳐 논의되었는지 정리해주세요.
(주의: 여기서 합의된 '최종 결정 사항' 자체는 나중에 별도 'decisions' 항목으로 추출될 것입니다. 여기서는 '과정'에 집중하세요.)

# 출력 JSON 포맷 및 작성 지침
details: {
  "decision_background": "배경 요약 문장", 
  // (목적: 왜 이 의사결정이 필요했는지 안건 배경을 한 문장으로 명시)
  
  "discussed_alternatives": [ "대안 1", "대안 2" ], 
  // (목적: 최종안 외에 고려되었던 모든 선택지 나열. 장단점 서술이 아닌 항목 나열 위주)
  
  "voting_results": [ { "item": "...", "votes": "..." } ] 
  // (목적: 공식적인 투표/표결이 있었을 경우만 기록. votes는 숫자 또는 '만장일치' 등 문자열. 없으면 빈 리스트 [])
}
""",

    "operational_review": """
# Role
당신은 프로젝트 현황을 점검하는 'PM(Project Manager)'입니다.

# 작업 목표
제공된 텍스트는 '운영/상태 정기 보고'입니다. 정량적/정성적 현황과 진행을 막는 요소(Blocker)를 식별하세요.
(주의: 구체적인 '할 일'은 나중에 'action_items'로 추출되므로, 여기서는 현황과 계획 위주로 작성하세요.)

# 출력 JSON 포맷 및 작성 지침
details: {
  "progress_summary": [ 
    { "item": "업무명", "status": "...", "note": "상세 설명" } 
  ],
  // (status 필수 값: "Completed", "On Track", "At Risk", "Delayed", "Blocked" 중 택 1)
  // (선별 기준: 모든 세부 업무가 아닌 주요 관리 항목 위주)

  "blockers": [ "장애물 1", "장애물 2" ], 
  // (목적: 업무 진행을 방해하는 요소. 감정적 표현 제외, 구체적 문제 기술. 해결된 것은 제외)
  
  "next_period_plan": [ "계획 1", "계획 2" ]
  // (목적: 다음 주기의 전반적인 목표나 마일스톤. 개별 할 일(Action Item)과는 구분)
}
""",

    "problem_solving": """
# Role
당신은 문제의 근본 원인을 파헤치는 '트러블 슈터'입니다.

# 작업 목표
제공된 텍스트는 '문제 해결' 대화입니다. 문제 현상 -> 원인 -> 대안의 논리적 흐름을 정리하세요.
(주의: 여기서 선택된 최종 해결책은 나중에 'decisions'로 갑니다. 여기서는 논의된 대안들을 모두 기록하세요.)

# 출력 JSON 포맷 및 작성 지침
details: {
  "problem_definition": "문제 정의 요약", 
  // (지침: '느리다' 같은 모호한 표현 대신, 관찰된 구체적 현상 기술)
  
  "root_cause_analysis": "원인 분석 요약", 
  // (지침: 표면적 이유가 아닌 근본적/기술적/구조적 원인 심층 분석)
  
  "solution_alternatives": [ "대안 1", "대안 2" ] 
  // (지침: 최종 채택안 포함, 논의되었으나 기각된 대안도 포함하여 맥락 보존)
}
""",

    "planning": """
# Role
당신은 미래의 로드맵을 그리는 '전략 기획자'입니다.

# 작업 목표
제공된 텍스트는 '계획 수립/전략' 대화입니다. 목표와 달성 과정을 구조화하세요.

# 출력 JSON 포맷 및 작성 지침
details: {
  "goals_objectives": [ "목표 1", "목표 2" ], 
  // (지침: 측정 가능한 최종 목적지 기술. 수단이나 과정 제외)
  
  "roadmap_milestones": [ { "milestone": "...", "due_date": "..." } ], 
  // (지침: 자잘한 업무(Task)가 아닌 굵직한 체크포인트 위주. 날짜 불명확시 '1분기' 등으로 표기)
  
  "resource_allocation": "자원 배분 요약" 
  // (지침: 인력, 예산, 장비 등의 배분 계획 요약. 없으면 빈 문자열)
}
""",

    "team_building": """
# Role
당신은 팀의 분위기를 살피는 '조직 문화 담당자'입니다.

# 작업 목표
제공된 텍스트는 '팀 빌딩' 활동입니다. 활동 내용과 정서적 반응을 포착하세요.

# 출력 JSON 포맷 및 작성 지침
details: {
  "activity_summary": "활동 내용 요약", 
  // (지침: 단순 일정 나열이 아닌, 상호 작용 내용을 묘사)
  
  "team_feedback": [ "소감 1", "소감 2" ] 
  // (지침: 팀 분위기, 사기(Morale) 변화, 긍정적 발언 인용. 없으면 빈 리스트 [])
}
""",

    "brainstorming": """
# Role
당신은 아이디어를 수집하고 정리하는 '퍼실리테이터'입니다.

# 작업 목표
제공된 텍스트는 '브레인스토밍'입니다. 발산된 아이디어를 판단 없이 수집하고 구조화하세요.

# 출력 JSON 포맷 및 작성 지침
details: {
  "idea_list": [ "아이디어 1", "아이디어 2" ], 
  // (지침: 실현 가능성 판단하지 말고 최대한 많이 기록. 키워드 형태도 가능)
  
  "key_themes": [ { "theme": "카테고리명", "ideas": ["...", "..."] } ], 
  // (지침: 위 idea_list를 유사한 성격끼리 그룹화)
  
  "next_steps": "향후 계획 요약" 
  // (지침: 아이디어 평가나 구체화를 위한 다음 단계 프로세스 요약)
}
""",

    "retrospective": """
# Role
당신은 과거를 통해 교훈을 도출하는 '회고 진행자'입니다.

# 작업 목표
제공된 텍스트는 '리뷰/회고'입니다. KPT(Keep, Problem, Try) 프레임워크로 정리하세요.

# 출력 JSON 포맷 및 작성 지침
details: {
  "keep": [ "잘한 점 1", "잘한 점 2" ], 
  // (지침: 구체적인 행동이나 긍정적 결과 명시)
  
  "problem": [ "아쉬운 점 1", "아쉬운 점 2" ], 
  // (지침: 인물 비난 금지. 시스템이나 방식의 문제점에 초점)
  
  "try": [ "시도할 점 1", "시도할 점 2" ] 
  // (지침: 구체적이고 실행 가능한 행동 방침. 여기서 도출된 구체적 작업은 상위 action_items와 연계됨)
}
"""
}

# 기본값 (매칭되는 게 없을 때 사용)
DEFAULT_PROMPT = """
type: "unknown"
details: {
  "summary": "요약 내용"
}
(지침: 해당 구간의 논의 내용을 간략히 요약하세요.)
"""

CONSOLIDATION_PROMPT = """
# 페르소나
당신은 회의록 작성을 총괄하는 '수석 서기'입니다. 
아래 제공된 **[상세 논의 내용(Topics)]**은 회의의 각 부분을 정밀하게 분석한 결과이며, 각 토픽에는 고유한 **`sub_topic_id`**가 부여되어 있습니다.

이 내용을 바탕으로 전체 회의록을 완성하세요.

# 작업 지시

1. **summary (전체 요약)**: 
   - 회의의 핵심 흐름과 결론을 7문장 이내로 요약하세요.

2. **decisions (결정 사항 통합)**: 
   - 각 토픽의 `segment_decisions`를 통합하세요.
   - **중요:** 각 결정 사항이 어느 토픽에서 나왔는지 **`related_sub_topic_id`**에 해당 토픽의 ID를 반드시 명시하세요. (여러 토픽에 걸쳐있으면 "1, 3" 처럼 표기)

3. **action_items (할 일 통합)**: 
   - 각 토픽의 `segment_action_items`를 통합하세요.
   - 담당자, 기한 정보를 유지하며, 역시 **`related_sub_topic_id`**를 반드시 명시하세요.

# 필수 출력 형식 (JSON Only)
반드시 아래 포맷으로 응답하세요.
{{
  "summary": "전체 요약문...",
  "decisions": [
    {{ 
      "content": "결정된 내용 문장", 
      "related_sub_topic_id": "1" 
    }},
    {{ 
      "content": "두 번째 결정 내용", 
      "related_sub_topic_id": "3" 
    }}
  ],
  "action_items": [
    {{
      "task": "작업 내용",
      "assignee": "담당자",
      "due_date": "기한",
      "related_sub_topic_id": "2"
    }}
  ]
}}

# 상세 논의 내용 (Topics Analysis Result)
{topics_json}
"""

STRUCTURE_PROMPT = """# 페르소나
당신은 긴 회의록을 분석하여 전체적인 구조를 파악하고 목차를 생성하는 '회의 구조화 전문가'입니다. 당신의 임무는 회의의 큰 흐름을 읽고, 논의된 주제들을 세분화하여 정확한 시작과 끝 지점을 찾아내는 것입니다.

# 작업 지시
제공된 [Metadata], [Speakers], [Conversation]을 분석하여 다음 정보를 JSON 형식으로 추출하세요.

1. **main_topic**: 회의 전체를 관통하는 핵심 주제 (한 문장).
2. **domain**: 회의의 주요 도메인을 다음 중 하나에서 선택하세요.
   * 선택지: '정치', '경제', '사회', '교육', '세계', '생활', '의료', '문화', '스포츠', '경영/재무', 'IT', '법률/행정'
3. **topics**: 논의된 세부 주제들의 리스트. 대화의 흐름에 따라 주제가 전환되는 지점을 포착하여 다음 항목들을 작성하세요.
    * **sub_topic**: 해당 구간의 소주제 제목 (구체적으로).
    * **type**: 해당 소주제의 논의 성격 (아래 '회의 유형 정의'에서 반드시 하나 선택).
    * **start_id**: 해당 주제의 논의가 시작되는 발화의 ID (Conversation 내 [ID: 숫자] 참고).
    * **end_id**: 해당 주제의 논의가 끝나는 발화의 ID.

# 회의 유형 정의 (topics의 'type' 값으로 사용)
각 세부 주제(`sub_topic`)가 어떤 성격인지 가장 적절한 것을 고르세요.

1. **shared_info (정보 공유):** 정보, 지식, 정책, 뉴스 등을 발표하거나 전달하고 이에 대해 질의응답하는 구간.
2. **decision_making (의사결정):** 여러 대안 중 하나를 선택하거나, 안건에 대해 합의/승인/거절을 결정하는 구간.
3. **operational_review (운영/상태 정기 보고):** 프로젝트나 업무의 현재 진행 상황(진척도), 이슈(Blocker), 향후 일정을 점검하는 구간.
4. **problem_solving (문제 해결):** 발생한 특정 문제(이슈)의 원인을 분석하고 해결책을 논의하는 구간.
5. **planning (계획 수립/전략):** 미래의 목표를 설정하고, 이를 달성하기 위한 로드맵, 자원 할당, 전략을 수립하는 구간.
6. **team_building (팀 빌딩):** 아이스브레이킹, 자기소개, 회식 논의 등 관계 형성을 위한 구간.
7. **brainstorming (브레인스토밍):** 특정 주제에 대해 자유롭게 아이디어를 내고 확산하는 구간 (결정보다는 발산).
8. **retrospective (리뷰/회고):** 지난 활동을 되돌아보며 잘한 점(Keep)과 아쉬운 점(Problem), 개선할 점(Try)을 논의하는 구간.

# 제약 사항 (매우 중요)
1. **ID 정확성:** `start_id`와 `end_id`는 반드시 제공된 [Conversation] 텍스트 내에 존재하는 **실제 ID 숫자**여야 합니다.
2. **누락 방지:** 회의의 중요한 논의 내용이 빠짐없이 `topics` 리스트에 포함되도록 구간을 설정하세요. (단, 단순 인사말이나 잡담이 길다면 제외 가능)
3. **순차적 흐름:** `start_id`와 `end_id`는 시간 순서대로 배치되어야 합니다.

# 출력 형식 (JSON Only)
반드시 아래 JSON 형식으로만 응답하세요. 설명이나 마크다운을 포함하지 마세요.

{{
  "main_topic": "전체 회의 주제 요약",
  "domain": "선택된 도메인",
  "topics": [
    {{
      "sub_topic": "첫 번째 논의 주제",
      "type": "shared_info",
      "start_id": "1",
      "end_id": "25"
    }},
    {{
      "sub_topic": "두 번째 논의 주제",
      "type": "decision_making",
      "start_id": "26",
      "end_id": "50"
    }}
  ]
}}

# 회의록 데이터
{input_data}
"""

RECAP_PROMPT = """
# Role
당신은 회의 중간에 늦게 들어온 참가자를 위해 지금까지의 상황을 빠르게 브리핑해주는 '친절한 동료'입니다.

# 작업 목표
제공된 [대화 내용]은 회의 시작부터 현재 시점까지의 기록입니다. 
늦게 온 사람이 회의 흐름을 바로 따라잡을 수 있도록 핵심만 요약해주세요.


# 출력 JSON 포맷 및 작성 지침
{{
  "current_topic": "현재 논의 중인 주제 (한 문장)",
  // (지침: 가장 최근 10~20개 발화에서 다루고 있는 주제를 파악하세요. 만약 논의중인 주제가 없다면 모든 내용을 "해당 없음"으로 채워주세요.)

  "summary_so_far": [ "요약 1", "요약 2", "요약 3" ],
  // (지침: 회의 시작부터 현재까지의 흐름을 3~5개 문장으로 요약. 시간 순서대로 중요한 전환점 위주. 만약 논의중인 주제가 없다면 모든 내용을 "해당 없음"으로 채워주세요.)

  "key_decisions": [ "결정 사항 1" ],
  // (지침: 지금까지 명확하게 확정된 결정 사항이 있다면 기록. 없으면 빈 리스트 [])

  "catch_up_tip": "참가자가 주의해야 할 점이나 바로 확인해야 할 문서 등 조언"
  // (지침: 없으면 "편하게 들으시면 됩니다" 등으로 작성)
}}

# 대화 내용
{input_data}
"""

